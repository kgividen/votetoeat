<!DOCTYPE html>
<html ng-app="myApp">
<head>
    <title>Vote To Eat</title>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <title>Vote To Eat</title>
    <!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!--[if lt IE 9]>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html5shiv/3.7.2/html5shiv.js"></script>
    <![endif]-->
    <link rel="apple-touch-icon" sizes="57x57" href="/icons/apple-touch-icon-57x57.png">
    <link rel="apple-touch-icon" sizes="60x60" href="/icons/apple-touch-icon-60x60.png">
    <link rel="apple-touch-icon" sizes="72x72" href="/icons/apple-touch-icon-72x72.png">
    <link rel="apple-touch-icon" sizes="76x76" href="/icons/apple-touch-icon-76x76.png">
    <link rel="apple-touch-icon" sizes="114x114" href="/icons/apple-touch-icon-114x114.png">
    <link rel="apple-touch-icon" sizes="120x120" href="/icons/apple-touch-icon-120x120.png">
    <link rel="apple-touch-icon" sizes="144x144" href="/icons/apple-touch-icon-144x144.png">
    <link rel="apple-touch-icon" sizes="152x152" href="/icons/apple-touch-icon-152x152.png">
    <link rel="apple-touch-icon" sizes="180x180" href="/icons/apple-touch-icon-180x180.png">
    <link rel="icon" type="image/png" href="/icons/favicon-32x32.png" sizes="32x32">
    <link rel="icon" type="image/png" href="/icons/android-chrome-192x192.png" sizes="192x192">
    <link rel="icon" type="image/png" href="/icons/favicon-96x96.png" sizes="96x96">
    <link rel="icon" type="image/png" href="/icons/favicon-16x16.png" sizes="16x16">
    <link rel="manifest" href="/manifest.json">
    <meta name="msapplication-TileColor" content="#da532c">
    <meta name="msapplication-TileImage" content="/mstile-144x144.png">
    <meta name="theme-color" content="#ffffff">

    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.2/css/bootstrap.min.css">
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.2/css/bootstrap-theme.min.css">
    <link type="text/css" href="css/lib/angular-growl-0.7.3.min.css" rel="stylesheet"/>
    <link href="css/custom.css" rel="stylesheet">

    <!--Loading only angular here but all other js at the bottom.  Mainly so ng-cloak works correctly-->
    <script src="https://ajax.googleapis.com/ajax/libs/angularjs/1.2.15/angular.min.js"></script>
    <script src="https://ajax.googleapis.com/ajax/libs/angularjs/1.2.15/angular-animate.min.js"></script>
    <script src="js/lib/angular-growl-0.7.3.min.js"></script>

</head>
<body ng-controller="vteController" role="document">
<div class="container">
    <div class="clearfix">
        <nav >
            <ul class="nav nav-pills pull-right" ng-cloak ng-show="showMainApp">
                <li role="presentation"><a href="./index.html" ng-click="logout()">Logout</a></li>
                <!--<li role="presentation"><a href="#">About</a></li>-->
                <!--<li role="presentation"><a href="#">Contact</a></li>-->
            </ul>
        </nav>
        <h3 class="text-muted">Vote To Eat</h3>
        <hr/>
    </div>

    <div class="container" role="main" ng-hide="showMainApp">
        <div class="jumbotron">
            <h1>Vote To Eat!</h1>
            <p>Tired of arguing about where to eat?  This site is for you.</p>
            <div growl inline="true" reference="generalMessages"></div>
            <p id="createGroupBox" ng-show="showGroupBox">
                <button type="button" class="btn btn-primary btn-lg" data-toggle="modal" data-target="#groupModal" ng-click="joinOrCreateBtn = 'create'">Create Group &raquo;</button>
                <button type="button" class="btn btn-primary btn-lg" data-toggle="modal" data-target="#groupModal" ng-click="joinOrCreateBtn = 'join'">Join Group &raquo;</button>
            </p>
        </div>
    </div>
    <button class="btn btn-link" data-toggle="modal" data-target="#suggestionsModal" ng-click="setSuggestionsGroup('yelp')">Yelp Suggestions</button>
    <!--<button class="btn btn-link" data-toggle="modal" data-target="#suggestionsModal" ng-click="setSuggestionsGroup('google')">Google Suggestions</button>-->
    <div id="map"></div>

    <div id="main_app" class="container" ng-cloak ng-show="showMainApp">
        <div class="row">
            <h1 class="pull-left">Hello {{userName}}.</h1>
        </div>
        <div class="row">
            <h4 class="lead">Add some places you'd like to eat.  Give each place a score based on how much you'd like to eat there.  The highest score wins!</h4>
        </div>
        <div class="row">
            <div class="col-md-12">
                <h2>Places</h2>
                <form class="form-inline">
                    <div class="form-group">
                        <label for="input_add_place_name">Add New Place</label>
                        <input type="text" class="form-control" id="input_add_place_name" placeholder="Place Name" ng-model="placeName">
                    </div>
                    <button type="submit" title="Add Place" class="btn btn-primary" data-dismiss="modal" ng-click="addPlace()">Add</button>
                    <button class="btn btn-link" data-toggle="modal" data-target="#suggestionsModal" ng-click="setSuggestionsGroup('yelp')">Yelp Suggestions</button>
                    <button class="btn btn-link" data-toggle="modal" data-target="#suggestionsModal" ng-click="setSuggestionsGroup('google')">Google Suggestions</button>
                    <!--<button class="btn btn-link" data-toggle="modal" data-target="#suggestionsModal" ng-click="setSuggestionsGroup('groupon')">Groupon Suggestions</button>-->
                </form>
                <div class="col-md-12" ng-class="{true: 'well'}[places.length > 0]">
                    <div class="row" ng-repeat="place in places">
                        <div class="row">
                            <div class="col-md-4">
                                <a target="_blank" ng-href="http://google.com/maps?q={{place.name}}">
                                    <h4 class="display-inline" ng-bind="place.name"></h4>
                                </a>
                            <span ng-show="place.fromType == 'google'">
                                <a target="_blank"  ng-href="http://google.com/local?q={{place.name}},{{place.address}}">
                                    <img src="images/img_trans.gif" class="googleLogoSmall" alt="google">
                                    <rating ng-model="place.rating" readonly="true"></rating>
                                </a>
                            </span>
                            <span ng-show="place.fromType == 'yelp'">
                                <a target="_blank" ng-href="{{place.url}}">
                                    <img src="images/img_trans.gif" class="yelpLogoSmall" alt="yelp">
                                    <img ng-src="{{place.rating_img_url}}">
                                </a>
                                <a class="link hand" target="_blank" title="{{place.deal.what_you_get}}" ng-show="place.deal!=null" ng-href="{{place.deal.url}}">
                                    <span class="glyphicon glyphicon-check" aria-hidden="true" ></span>
                                </a>
                            </span>
                                <a title="{{place.address}}" target="_blank" ng-href="http://google.com/maps?q={{place.name}},{{place.address}}">
                                    <div class="indent-5"><small ng-bind="place.address"></small></div>
                                </a>
                            </div>
                            <div class="col-md-8">
                                <div class="btn-group">
                                    <button class="btn btn-default" ng-class="{'active':place.voteBtnActive == $index }" ng-click="voteForPlace(place,$index)" ng-repeat="i in getNumber(vote_max) track by $index" >
                                        {{$index}}
                                    </button>
                                </div>
                                <span>
                                    <span ng-bind="place.totalVotes"></span><span>&nbsp total</span>
                                    <span ng-show="place.winning" title="Winning!" class="winning glyphicon glyphicon-ok" aria-hidden="true" ></span>
                                </span>
                            </div>
                        </div>
                        <br/>
                    </div>
                </div>
            </div>
        </div>
        <div class="row">
            <div class="col-md-12">
                <h2>Members of {{groupName}}</h2>
                <div class="col-md-12 well">
                    <div class="row" ng-repeat="user in users">
                        <div class="col-md-3">
                            <span ng-bind="user.name"></span>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="row">
            <div class="col-md-12" growl inline="true"></div>
        </div>
    </div>


    <div>
        <!--Debug showing the scope -->
        <!--<pre ng-bind="businessData |json"></pre>-->
        <hr>

        <footer>
            <p>&copy; Vote To Eat 2015</p>
        </footer>

    </div>
</div> <!--Container-->

<!--MODALS-->
<div id="groupModal" class="modal fade" tabindex="-1" role="dialog" aria-labelledby="createGroupModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
                <h4 class="modal-title" id="createGroupLabel">Group</h4>
            </div>
            <div class="modal-body">
                <form ng-show="!showSetUserName" class="form-inline">
                    <div class="form-group">
                        <label for="inputGroupName">Group Name</label>
                        <input type="text" class="form-control" id="inputGroupName" placeholder="Group Name" ng-model="groupName">
                    </div>
                    <button ng-show="joinOrCreateBtn == 'create'" type="submit" class="btn btn-primary" ng-click="createGroup()">Create Group</button>
                    <button ng-show="joinOrCreateBtn == 'join'" type="submit" class="btn btn-primary" ng-click="joinGroup()">Join Group</button>
                </form>
                <div ng-show="showSetUserName">
                    <label for="group_name">Group Name</label>
                    <span id="group_name" ng-bind="groupName"></span>
                    <form  class="form-inline">
                        <div class="form-group">
                            <label for="inputUserName">Your Name</label>
                            <input type="text" class="form-control" id="inputUserName" focus-on="showSetUserName" placeholder="User Name" ng-model="userName" >
                        </div>
                        <button type="submit" class="btn btn-primary" data-dismiss="modal" ng-click="addUser()">Save</button>
                    </form>
                </div>
            </div>
        </div>
    </div>
</div>

<div id="suggestionsModal" class="modal fade" tabindex="-1" role="dialog" aria-labelledby="suggestionsModal" aria-hidden="true">
    <div growl reference="suggestionsMessages"></div>
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
                <h4 class="modal-title" ng-bind="suggestionTitle"></h4>
            </div>
            <div class="businessesList modal-body">
                <form class="form-inline">
                    <div ng-class="form-group">
                    <!--Show input box and location icon for yelp.  Needs to be ng-show because ng-if destroys scope on the ng-models-->
                        <div ng-show="currentSuggestionGroup == 'yelp'" >
                            <label for="yelp_city">Enter City</label>
                            <input type="text" class="form-control" id="yelp_city" placeholder="City" ng-model="location">
                            <button class="btn btn-primary" title="Enter a City" ng-click="getYelpData('city', sortType);" ng-disabled="location.length==0">Yelp By City</button>
                            <button class="btn btn-primary" title="Get Current Location" ng-click="getYelpData('cll', sortType)">
                                <span class="glyphicon glyphicon-map-marker hand"  aria-hidden="true" ></span>
                            </button>
                            <br/><br/>
                            <label>Sort Again By:</label>
                            <div class="btn-group" role="group">
                                <button type="button" class="btn btn-default" ng-class="{active:sortType === 0}" ng-click="updateYelpSortData(0)">Best Match</button>
                                <button type="button" class="btn btn-default" ng-class="{active:sortType === 1}" ng-click="updateYelpSortData(1)">Location</button>
                                <button type="button" class="btn btn-default" title="The rating sort is not strictly sorted by the rating value, but by an adjusted rating value that takes into account the number of ratings, similar to a bayesian average. This is so a business with 1 rating of 5 stars doesnâ€™t immediately jump to the top."
                                        ng-class="{active:sortType === 2}" ng-click="updateYelpSortData(2)">Rating</button>
                            </div>
                            <button class="btn btn-default" ng-class="{active:dealsOnly === true}" ng-click="updateYelpSortDataWithDeals()">Deals Only</button>
                            <!--<button class="btn btn-primary" title="Get Current Location" ng-click="updateYelpSortData();businessData=[];yelpOffset=0">Update Search</button>-->
                        </div>
                        <div ng-repeat="business in businessData">
                            <div ng-show="currentSuggestionGroup == 'yelp'">
                                <button class="btn btn-link" title="Add Place" ng-click="addBusiness(business,'yelp')">{{business.name}}</button>
                                <a target="_blank" ng-href="{{business.url}}">
                                    <img title="Open in Yelp" ng-src="{{business.rating_img_url}}">
                                </a>
                                <a target="_blank" ng-href="{{business.url}}">
                                    <img src="images/img_trans.gif" ng-class="currentSuggestionGroup == 'yelp' ? 'yelpLogoSmall' : 'googleLogoSmall'" />
                                </a>
                                <a class="hand" target="_blank" title="{{business.deals[0].what_you_get}}" ng-show="business.deals.length > 0" ng-href="{{business.deals[0].url}}">
                                    <span class="glyphicon glyphicon-check" aria-hidden="true" ></span>
                                </a>
                                <a target="_blank" ng-href="http://google.com/maps?q={{business.name}},{{business.location.display_address}}">
                                    <small ng-repeat="address in business.location.display_address">{{address}} </small>
                                </a>
                            </div>
                            <div ng-show="currentSuggestionGroup == 'google'">
                                <button class="btn btn-link" title="Add Place" ng-click="addBusiness(business,'google')">{{business.name}}</button>
                                <a target="_blank" ng-href="http://google.com/local?q={{business.name}},{{business.vicinity}}">
                                    <img src="images/img_trans.gif" class="googleLogoSmall" title="Open in Google" alt="google">
                                </a>
                                <a target="_blank" ng-href="http://google.com/local?q={{business.name}},{{business.vicinity}}">
                                    <rating ng-model="business.rating" readonly="true"></rating>
                                </a>
                                <a target="_blank" ng-href="http://google.com/maps?q={{business.name}},{{business.vicinity}}">
                                    <small ng-bind="business.vicinity"></small>
                                </a>
                            </div>
                        </div>
                        <div>
                            <!--<span ng-show="businessData.length === 0 || showLoading===true">Loading . . .</span>-->
                            <span ng-show="showLoading===true">Loading . . .</span>
                        </div>
                        <button class="btn btn-primary pull-right"
                                title="Yelp will only allow up to 40 businesses when searching by location.  Search by 'best' match for more than 40"
                                ng-disabled="businessData.length >= 40" ng-hide="businessData.length === 0 || sortType == 0" ng-click="getMoreYelpData()">Next 20</button>
                        <button class="btn btn-primary pull-right" ng-show="businessData.length > 0 && sortType === 0" ng-click="getMoreYelpData()">Next 20</button>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button type="submit" class="btn btn-primary pull-right" data-dismiss="modal">Done</button>
                <img src="images/img_trans.gif" class="pull-left" ng-class="currentSuggestionGroup == 'yelp' ? 'yelpPoweredBy' : 'googlePoweredBy'" />
            </div>
        </div>
    </div>
</div>
<!-- JavaScript Files================================================== -->
<!-- Placed at the end of the document so the pages load faster -->
<script src="https://codeorigin.jquery.com/jquery-1.10.2.min.js"></script>
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.2/js/bootstrap.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/angular-ui-bootstrap/0.12.1/ui-bootstrap-tpls.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/underscore.js/1.6.0/underscore-min.js"></script>
<script type='text/javascript' src='/socket.io/socket.io.js'></script>
<script type="text/javascript" src="https://maps.googleapis.com/maps/api/js?libraries=places"></script>

<script type="text/javascript" src='js/vte_util.js'></script>
<script type="text/javascript" src='js/directives.js'></script>
<script type="text/javascript" src='js/services.js'></script>
<script type="text/javascript" src='js/controllers.js'></script>

<script>
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
        (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
            m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

    ga('create', 'UA-44755430-2', 'auto');
    ga('send', 'pageview');

</script>
</body>
</html>